<div class="app-container">
  <div class="main-content">
    <!-- –®–∞–ø–∫–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
    <header class="header">
      <div class="header-content">
        <div class="date-navigation">
          <button class="nav-btn" (click)="previousDay()" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å">
            <i class="icon-chevron-left">‚Äπ</i>
          </button>

          <button class="nav-btn today-btn" (click)="setToday()" [class.active]="isToday">
            –°–µ–≥–æ–¥–Ω—è
          </button>

          <button class="nav-btn" (click)="nextDay()" title="–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å">
            <i class="icon-chevron-right">‚Ä∫</i>
          </button>

          <div class="current-date">
            {{ formattedDate }}
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å —à–∞–ø–∫–∏ -->
        <div class="header-right">
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —à–∞–ø–∫–µ -->
          <div class="header-stats">
            <div class="stat-item">
              <span class="stat-value">{{ monthlyStats?.completedTasks || 0 }}</span>
              <span class="stat-label">/{{ monthlyStats?.totalTasks || 0 }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ monthlyStats?.productivity || 0 }}%</span>
              <span class="stat-label">–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
          <div class="user-info" *ngIf="currentUser">
            <div class="user-details">
              <div class="user-name-row">
                <span class="user-name">{{ currentUser.name }}</span>
                <span *ngIf="isAdmin" class="admin-badge">ADMIN</span>
              </div>
              <span class="user-email">{{ currentUser.email }}</span>
            </div>
            <div class="user-actions">
              <button *ngIf="isAdmin" class="invite-btn" (click)="showInviteSection = !showInviteSection" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞–º–∏">
                <i class="icon-invite">üë•</i>
              </button>
              <button class="logout-btn" (click)="logout()" title="–í—ã–π—Ç–∏">
                <i class="icon-logout">üö™</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- –ü–æ–ø–∞–ø –¥–ª—è –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤ -->
    <div class="invite-popup-overlay" *ngIf="showInviteSection" (click)="showInviteSection = false">
      <div class="invite-popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–∞–º–∏</h3>
          <button class="close-btn" (click)="showInviteSection = false">√ó</button>
        </div>
        <div class="popup-content">
          <div class="invite-section">
            <h4>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥</h4>
            <p class="text-sm">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
            <button class="btn-primary" (click)="generateInviteCode()" [disabled]="isGeneratingCode">
              {{ isGeneratingCode ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–∞–π—Ç-–∫–æ–¥' }}
            </button>
            <div *ngIf="newInviteCode" class="new-code-section">
              <p><strong>–ù–æ–≤—ã–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω!</strong></p>
              <div class="code-display">
                {{ newInviteCode }}
              </div>
              <p class="text-sm">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º —Å —Ç–µ–º, –∫–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å</p>
            </div>
          </div>

          <div class="invite-section">
            <h4>–ú–æ–∏ –∏–Ω–≤–∞–π—Ç-–∫–æ–¥—ã</h4>
            <div *ngIf="userCodes.length > 0; else noCodes">
              <div class="codes-list">
                <div *ngFor="let code of userCodes" class="code-item" [class.used]="code.used">
                  <div class="code-info">
                    <span class="code-value">{{ code.code }}</span>
                    <div class="code-details">
                      <span class="code-status" [class.used]="code.used">
                        {{ code.used ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω' : '–î–æ—Å—Ç—É–ø–µ–Ω' }}
                      </span>
                      <span class="code-date">
                        —Å–æ–∑–¥–∞–Ω {{ formatDate(code.createdAt) }}
                        <span *ngIf="code.used"> ‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω {{ formatDate(code.usedAt) }}</span>
                      </span>
                    </div>
                  </div>
                  <div class="code-actions">
                    <button
                      *ngIf="!code.used"
                      class="delete-btn"
                      (click)="deleteInviteCode(code.code)"
                      title="–£–¥–∞–ª–∏—Ç—å –∫–æ–¥"
                    >
                      üóëÔ∏è
                    </button>
                    <span *ngIf="code.used" class="cannot-delete" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å">
                      ‚ö†Ô∏è
                    </span>
                  </div>
                </div>
              </div>

              <div class="codes-stats">
                <p class="text-sm">
                  –í—Å–µ–≥–æ –∫–æ–¥–æ–≤: {{ userCodes.length }} |
                  –î–æ—Å—Ç—É–ø–Ω–æ: {{ availableCodes.length }} |
                  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {{ userCodes.length - availableCodes.length }}
                </p>
              </div>
            </div>
            <ng-template #noCodes>
              <p class="text-sm">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–Ω–≤–∞–π—Ç-–∫–æ–¥–æ–≤</p>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="layout">
      <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <h4>–ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
          <div class="mini-stats">
            <div class="mini-stat">
              <div class="mini-stat-value">{{ monthlyStats?.completedTasks || 0 }}</div>
              <div class="mini-stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
            <div class="mini-stat">
              <div class="mini-stat-value">{{ monthlyStats?.totalTasks || 0 }}</div>
              <div class="mini-stat-label">–í—Å–µ–≥–æ</div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <h4>–ü—Ä–æ–≥—Ä–µ—Å—Å –º–µ—Å—è—Ü–∞</h4>
          <div class="progress-container">
            <div class="progress-info">
              <span>{{ monthlyStats?.productivity || 0 }}%</span>
            </div>
            <div class="progress-bar mini">
              <div
                class="progress-fill"
                [style.width.%]="monthlyStats?.productivity || 0"
              ></div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <h4>–°–µ–≥–æ–¥–Ω—è</h4>
          <div class="today-info">
            <p *ngIf="tasksToday > 0; else noTasksToday">
              <strong>{{ tasksToday }}</strong> –∑–∞–¥–∞—á
            </p>
            <ng-template #noTasksToday>
              <p>–ó–∞–¥–∞—á –Ω–µ—Ç</p>
            </ng-template>
          </div>
        </div>
      </aside>

      <!-- –ì–ª–∞–≤–Ω—ã–π –±–ª–æ–∫ —Å –∑–∞–¥–∞—á–∞–º–∏ -->
      <main class="tasks-main">
        <app-task-list></app-task-list>
      </main>
    </div>
  </div>
</div>
